<html>
  <head>
    <title>Add House</title>
    <link rel="stylesheet" href="/output.css" />
  </head>
  <body>
    <!-- Navbar -->
    <%- include('../partials/navbar.ejs') %>

    <!-- Heading -->
    <div class="max-w-md mx-auto mt-10 p-6 bg-white shadow-md rounded-lg">
      <h2 class="text-2xl font-semibold text-gray-800 mb-6 text-center">
        <%= editing ? "Edit" : "Register" %> Your House
      </h2>

      <!-- Form -->
      <form action="<%= editing ? '/host/edit-house' : '/host/add-house' %>" method="post" class="space-y-5" enctype="multipart/form-data">
        <% if (editing) { %>
          <input
            type="text"
            name="houseId"
            value="<%= house._id %>" 
            hidden
          >
        <% } %>
          
        <!-- Name Field -->
        <div>
          <label for="houseName" class="block mb-1 font-medium text-gray-700"
            >House Name:</label
          >
          <input
            type="text"
            name="houseName"
            id="houseName"
            placeholder="Enter your house name"
            value="<%= editing ? house.houseName : '' %>"
            required
            class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-400"
          />
        </div>

        <!-- City Field -->
        <div>
          <select
              name="houseLocation"
              id="houseLocation"
              required
              class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-400"
          >
              <option value="" disabled <%= !editing ? "selected" : "" %>>Select a state</option>
              <option value="andhra-pradesh" <%= editing && house.houseLocation === "andhra-pradesh" ? "selected" : "" %>>Andhra Pradesh</option>
              <option value="arunachal-pradesh" <%= editing && house.houseLocation === "arunachal-pradesh" ? "selected" : "" %>>Arunachal Pradesh</option>
              <option value="assam" <%= editing && house.houseLocation === "assam" ? "selected" : "" %>>Assam</option>
              <option value="bihar" <%= editing && house.houseLocation === "bihar" ? "selected" : "" %>>Bihar</option>
              <option value="chhattisgarh" <%= editing && house.houseLocation === "chhattisgarh" ? "selected" : "" %>>Chhattisgarh</option>
              <option value="goa" <%= editing && house.houseLocation === "goa" ? "selected" : "" %>>Goa</option>
              <option value="gujarat" <%= editing && house.houseLocation === "gujarat" ? "selected" : "" %>>Gujarat</option>
              <option value="haryana" <%= editing && house.houseLocation === "haryana" ? "selected" : "" %>>Haryana</option>
              <option value="himachal-pradesh" <%= editing && house.houseLocation === "himachal-pradesh" ? "selected" : "" %>>Himachal Pradesh</option>
              <option value="jharkhand" <%= editing && house.houseLocation === "jharkhand" ? "selected" : "" %>>Jharkhand</option>
              <option value="karnataka" <%= editing && house.houseLocation === "karnataka" ? "selected" : "" %>>Karnataka</option>
              <option value="kerala" <%= editing && house.houseLocation === "kerala" ? "selected" : "" %>>Kerala</option>
              <option value="madhya-pradesh" <%= editing && house.houseLocation === "madhya-pradesh" ? "selected" : "" %>>Madhya Pradesh</option>
              <option value="maharashtra" <%= editing && house.houseLocation === "maharashtra" ? "selected" : "" %>>Maharashtra</option>
              <option value="manipur" <%= editing && house.houseLocation === "manipur" ? "selected" : "" %>>Manipur</option>
              <option value="meghalaya" <%= editing && house.houseLocation === "meghalaya" ? "selected" : "" %>>Meghalaya</option>
              <option value="mizoram" <%= editing && house.houseLocation === "mizoram" ? "selected" : "" %>>Mizoram</option>
              <option value="nagaland" <%= editing && house.houseLocation === "nagaland" ? "selected" : "" %>>Nagaland</option>
              <option value="odisha" <%= editing && house.houseLocation === "odisha" ? "selected" : "" %>>Odisha</option>
              <option value="punjab" <%= editing && house.houseLocation === "punjab" ? "selected" : "" %>>Punjab</option>
              <option value="rajasthan" <%= editing && house.houseLocation === "rajasthan" ? "selected" : "" %>>Rajasthan</option>
              <option value="sikkim" <%= editing && house.houseLocation === "sikkim" ? "selected" : "" %>>Sikkim</option>
              <option value="tamil-nadu" <%= editing && house.houseLocation === "tamil-nadu" ? "selected" : "" %>>Tamil Nadu</option>
              <option value="telangana" <%= editing && house.houseLocation === "telangana" ? "selected" : "" %>>Telangana</option>
              <option value="tripura" <%= editing && house.houseLocation === "tripura" ? "selected" : "" %>>Tripura</option>
              <option value="uttar-pradesh" <%= editing && house.houseLocation === "uttar-pradesh" ? "selected" : "" %>>Uttar Pradesh</option>
              <option value="uttarakhand" <%= editing && house.houseLocation === "uttarakhand" ? "selected" : "" %>>Uttarakhand</option>
              <option value="west-bengal" <%= editing && house.houseLocation === "west-bengal" ? "selected" : "" %>>West Bengal</option>

              <!-- Union Territories -->
              <option value="andaman-nicobar" <%= editing && house.houseLocation === "andaman-nicobar" ? "selected" : "" %>>Andaman and Nicobar Islands</option>
              <option value="chandigarh" <%= editing && house.houseLocation === "chandigarh" ? "selected" : "" %>>Chandigarh</option>
              <option value="dadra-nagar-haveli" <%= editing && house.houseLocation === "dadra-nagar-haveli" ? "selected" : "" %>>Dadra and Nagar Haveli and Daman and Diu</option>
              <option value="delhi" <%= editing && house.houseLocation === "delhi" ? "selected" : "" %>>Delhi (NCT)</option>
              <option value="jammu-kashmir" <%= editing && house.houseLocation === "jammu-kashmir" ? "selected" : "" %>>Jammu and Kashmir</option>
              <option value="ladakh" <%= editing && house.houseLocation === "ladakh" ? "selected" : "" %>>Ladakh</option>
              <option value="lakshadweep" <%= editing && house.houseLocation === "lakshadweep" ? "selected" : "" %>>Lakshadweep</option>
              <option value="puducherry" <%= editing && house.houseLocation === "puducherry" ? "selected" : "" %>>Puducherry</option>
          </select>
        </div>

        <!-- Price Field -->
        <div>
          <label for="housePrice" class="block mb-1 font-medium text-gray-700"
            >Price per day:</label
          >
          <input
            type="number"
            name="housePrice"
            id="housePrice"
            placeholder="Enter price per day"
            value="<%= editing ? house.housePrice : '' %>"
            required
            class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-400"
          />
        </div>

        <!-- imageURL input -->
        <div>
          <label
            for="image"
            class="block mb-1 font-medium text-gray-700"
            >House Photos:</label
          >
          <div class="relative">
            <input
              type="file"
              name="image"
              id="image"
              required
              multiple
              accept="image/jpg, image/jpeg, image/png"
              class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10"
              onchange="displayFileNames(this)"
            />
            <div class="w-full px-4 py-2 border border-gray-300 rounded-md text-gray-500 bg-white hover:bg-gray-50 transition duration-300 text-center">
              <span>Click to upload images</span>
              <p class="text-xs mt-1">Support for multiple images</p>
            </div>
            <div id="fileList" class="mt-2 space-y-1"></div>
          </div>
        </div>

        <script>
          function displayFileNames(input) {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = '';
            
            const dataTransfer = new DataTransfer();
            
            for(let i = 0; i < input.files.length; i++) {
              const fileName = document.createElement('div');
              fileName.className = 'text-sm text-gray-600 bg-gray-100 p-2 rounded-md flex justify-between items-center';
              fileName.innerHTML = `
          <span>${input.files[i].name}</span>
          <div class="flex items-center gap-2">
            <span class="text-xs text-gray-500">${(input.files[i].size / 1024).toFixed(2)} KB</span>
            <label class="cursor-pointer text-blue-500 hover:text-blue-700">
              <input type="file" accept="image/jpg, image/jpeg, image/png" class="hidden" onchange="replaceFile(${i}, this)">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
              </svg>
            </label>
          </div>
              `;
              fileList.appendChild(fileName);
              dataTransfer.items.add(input.files[i]);
            }
            
            input.files = dataTransfer.files;
          }

          function replaceFile(index, fileInput) {
            if (fileInput.files.length === 0) return;
            
            const input = document.getElementById('image');
            const dataTransfer = new DataTransfer();
            
            Array.from(input.files).forEach((file, i) => {
              if (i === index) {
          dataTransfer.items.add(fileInput.files[0]);
              } else {
          dataTransfer.items.add(file);
              }
            });
            
            input.files = dataTransfer.files;
            displayFileNames(input);
          }
        </script>

        <!-- description -->
        <div>
          <label
            for="houseDescription"
            class="block mb-1 font-medium text-gray-700"
            >House Description:</label
          >
          <textarea
            name="houseDescription"
            id="houseDescription"
            placeholder="Enter house description"
            rows="6"
            required
            class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-400"
          ><%= editing ? house.houseDescription : '' %></textarea>
        </div>

        <!-- Submit Button -->
        <div class="text-center">
          <button
            type="submit"
            class="bg-red-500 text-white px-6 py-2 rounded-md hover:bg-red-600 transition duration-300"
          >
            <%= editing ? "Update" : "Submit"%>
          </button>
        </div>
      </form>
    </div>
  </body>
</html>
